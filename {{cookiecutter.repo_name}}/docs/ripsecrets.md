# Using the `ripsecrets` pre-commit hook

[We use `ripsecrets` to check that no secrets are accidentally committed](ripsecrets). The
`ripsecrets` package does its best to prevent accidental committing of secrets, but it may miss
things. Instead, focus on good software development practices! See the [definition of a secret for
further information](#definition-of-a-secret).


## Initial setup

This pre-commit hook requires you to generate a baseline file if one is not already present within
the root directory. To create the baseline file, run the following at the root of the repository:

```shell
detect-secrets scan > .secrets.baseline
```

Next, audit the baseline that has been generated by running:

```shell
detect-secrets audit .secrets.baseline
```

When you run this command, you'll enter an interactive console. This will present you with a list
of high-entropy string and/or anything which could be a secret. It will then ask you to verify
whether this is the case. This allows the hook to remember false positives in the future, and alert
you to new secrets.


## Definition of a "secret"

See https://github.com/sirwart/ripsecrets?tab=readme-ov-file#how-it-works

## If `pre-commit` detects secrets during commit

If `pre-commit` detects any secrets when you try to create a commit, it will detail what it found
and where to go to check the secret.

If the detected secret is a false positive, there are two options to resolve this, and prevent your
commit from being blocked:

- [inline allowlisting of false positives (recommended)](#inline-allowlisting-recommended); or
- [updating the `.secretsignore` to include the false positives](#updating-secretsignore).

In either case, if an actual secret is detected (or a combination of actual secrets and false
positives), first remove the actual secret. Then following either of these processes.

### Inline allowlisting (recommended)

To exclude a false positive, add a `pragma` comment such as:

```python
secret = "Password123"  # pragma: allowlist secret
```

If the detected secret is actually a secret (or other sensitive information), remove the secret and
re-commit; there is no need to add any `pragma` comments.

If your commit contains a mixture of false positives and actual secrets, remove the actual secrets
first before adding `pragma` comments to the false positives.


### Updating `.secretsignore`

To exclude a false positive, you can also update the `.secretsignore` by repeating the same two

During auditing, if the detected secret is actually a secret (or other sensitive information),
remove the secret and re-commit. There is no need to update the `.secretsignore` file in this
case.

If your commit contains a mixture of false positives and actual secrets, remove the actual secrets
first before updating and auditing the `.secretsignore` file.

See https://github.com/sirwart/ripsecrets?tab=readme-ov-file#ignoring-secrets
for how to update the `.secretsignore` file.


---

Credit: This document has been adapted from the
[govukcookiecutter](https://github.com/best-practice-and-impact/govcookiecutter/).
